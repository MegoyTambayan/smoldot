<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Data structure. Inputs blocks, tries to fetch their runtime, and outputs blocks whose runtime is known."><meta name="keywords" content="rust, rustlang, rust-lang, download_tree"><title>smoldot::sync::download_tree - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../smoldot/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module download_tree</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><div id="sidebar-vars" data-name="download_tree" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input"name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">sync</a>::<wbr><a class="mod" href="#">download_tree</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/smoldot/sync/download_tree.rs.html#18-1489" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Data structure. Inputs blocks, tries to fetch their runtime, and outputs blocks whose runtime
is known.</p>
<h1 id="usage" class="section-header"><a href="#usage">Usage</a></h1>
<p>This data structure holds a tree of blocks whose runtime is either known, or not. This tree
can be updated by using <a href="struct.DownloadTree.html#method.input_insert_block" title="DownloadTree::input_insert_block"><code>DownloadTree::input_insert_block</code></a> and
<a href="struct.DownloadTree.html#method.input_finalize" title="DownloadTree::input_finalize"><code>DownloadTree::input_finalize</code></a>.</p>
<p>The data structure also holds a list of on-going runtime parameter downloads. Use
<a href="struct.DownloadTree.html#method.next_necessary_download" title="DownloadTree::next_necessary_download"><code>DownloadTree::next_necessary_download</code></a> to insert an ongoing download in the data structure.
It is the responsibility of the API user to actually perform the download and use
<a href="struct.DownloadTree.html#method.runtime_download_finished_existing" title="DownloadTree::runtime_download_finished_existing"><code>DownloadTree::runtime_download_finished_existing</code></a>,
<a href="struct.DownloadTree.html#method.runtime_download_finished_new" title="DownloadTree::runtime_download_finished_new"><code>DownloadTree::runtime_download_finished_new</code></a>, or <a href="struct.DownloadTree.html#method.runtime_download_failure" title="DownloadTree::runtime_download_failure"><code>DownloadTree::runtime_download_failure</code></a>
when this download is finished.</p>
<p>Whenever it is updated, the <a href="struct.DownloadTree.html" title="DownloadTree"><code>DownloadTree</code></a> can also update the block that it considers as
the “output best block” and the block that it considers as the “output finalized block”. These
blocks are guaranteed to have their runtime known.
At initialization, the data structure is initially in a “not ready” state, in which case
it doesn’t have any output best or finalized block. Use <a href="struct.DownloadTree.html#method.has_output" title="DownloadTree::has_output"><code>DownloadTree::has_output</code></a> to
determine whether the data structure is ready.</p>
<p>Finally, the data structure also holds a list of runtimes injected through
<a href="struct.DownloadTree.html#method.runtime_download_finished_new" title="DownloadTree::runtime_download_finished_new"><code>DownloadTree::runtime_download_finished_new</code></a>. You are strongly encouraged to periodically
call <a href="struct.DownloadTree.html#method.drain_unused_runtimes" title="DownloadTree::drain_unused_runtimes"><code>DownloadTree::drain_unused_runtimes</code></a> in order to free up resources.</p>
<h1 id="about-the-runtime-environment-upgrade-log-item" class="section-header"><a href="#about-the-runtime-environment-upgrade-log-item">About the runtime environment upgrade log item</a></h1>
<p>The code in this state machine parses block headers, and checks whether the “runtime
enviroment changed” log item is present in its digests. This log item has only been added to
Substrate on September 15th 2021. At the time of the writing of this comment, this change is
planned to be released as part of Polkadot v0.9.11. Consquently, blocks older than this
version never have this log item.</p>
<p>This means that, for older blocks, this state machine isn’t able to detect changes in the
runtime. Please be aware of this and do not use this state machine on old blocks.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="struct" href="struct.DownloadId.html" title="smoldot::sync::download_tree::DownloadId struct">DownloadId</a></div><div class="item-right docblock-short"><p>Identifier for a download in the <a href="struct.DownloadTree.html" title="DownloadTree"><code>DownloadTree</code></a>.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.DownloadParams.html" title="smoldot::sync::download_tree::DownloadParams struct">DownloadParams</a></div><div class="item-right docblock-short"><p>Information about a download that must be performed.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.DownloadTree.html" title="smoldot::sync::download_tree::DownloadTree struct">DownloadTree</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="struct" href="struct.OutputUpdateBlock.html" title="smoldot::sync::download_tree::OutputUpdateBlock struct">OutputUpdateBlock</a></div><div class="item-right docblock-short"><p>See <a href="enum.OutputUpdate.html" title="OutputUpdate"><code>OutputUpdate</code></a>.</p>
</div><div class="item-left module-item"><a class="struct" href="struct.RuntimeId.html" title="smoldot::sync::download_tree::RuntimeId struct">RuntimeId</a></div><div class="item-right docblock-short"><p>Identifier for a runtime in the <a href="struct.DownloadTree.html" title="DownloadTree"><code>DownloadTree</code></a>.</p>
</div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="enum" href="enum.NextNecessaryDownload.html" title="smoldot::sync::download_tree::NextNecessaryDownload enum">NextNecessaryDownload</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="enum" href="enum.OutputUpdate.html" title="smoldot::sync::download_tree::OutputUpdate enum">OutputUpdate</a></div><div class="item-right docblock-short"><p>See <a href="struct.DownloadTree.html#method.try_advance_output" title="DownloadTree::try_advance_output"><code>DownloadTree::try_advance_output</code></a>.</p>
</div><div class="item-left module-item"><a class="enum" href="enum.OutputUpdateBlockBest.html" title="smoldot::sync::download_tree::OutputUpdateBlockBest enum">OutputUpdateBlockBest</a></div><div class="item-right docblock-short"><p>See <a href="struct.OutputUpdateBlock.html" title="OutputUpdateBlock"><code>OutputUpdateBlock</code></a>.</p>
</div><div class="item-left module-item"><a class="enum" href="enum.RuntimeError.html" title="smoldot::sync::download_tree::RuntimeError enum">RuntimeError</a></div><div class="item-right docblock-short"><p>Error when analyzing the runtime.</p>
</div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="smoldot" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
    <script src="../../../main.js"></script>
</body></html>